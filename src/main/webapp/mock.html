<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
    <script src="http://backbonejs.org/backbone-min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/css/bootstrap2/bootstrap-switch.min.css"
          rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/js/bootstrap-switch.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>
<script type="text/template" id="search_template">
    <input type="checkbox" name="my-checkbox">
</script>

<div id="search_container"></div>

<div class="container">

</div>
<script type="text/javascript">
    var $cont = $('.container');
    var index = 0;
    for(i = 0; i < 10; i++){
        $cont.append('<div class="row">');
        for(j = 0; j < 10; j++){
            $cont.append('<div id="mock' + index + '" class="col-md-1">client # '+ index +'</div>');
            index++;
        }
        $cont.append('</div>');
    }

    var Mock = Backbone.Model.extend({
        url: 'rest/measure/mock'
    });
    var mock = new Mock;
    mock.fetch({
        async: false
    });
    var SearchView = Backbone.View.extend({
        initialize: function () {
            this.render();
            $(this.$el).find('[name="my-checkbox"]').bootstrapSwitch('state', mock.get('value'));
            $(this.$el).find('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function (event, state) {
                mock.set('value', state);
                mock.save();
            });
        },
        render: function () {
            var template = _.template($("#search_template").html(), {});
            this.$el.html(template);
        }
    });

    var search_view = new SearchView({el: $("#search_container")});
</script>

<div id="result_container"></div>

<script>
    var MockValue = Backbone.Model.extend({
        url: 'rest/measure/mock',
        defaults: {
            value: mock.get('value')
        }
    });
    var MockView = Backbone.View.extend({

        initialize: function (optional) {
            this.model = optional.model;
            this.$el = optional.el;
            this.listenTo(this.model, "change", this.render);
            this.render();
        },


        render: function () {
            this.$el.css("background-color", this.model.get('value') ? "green" : "red");
        }

    });


    var mockValues = [];
    var mockViews = [];
    for (i = 0; i < 100; i++) {
        window.setTimeout(function (ind) {
            mockValues[ind] = new MockValue();
            mockViews[ind] = new MockView({
                el: $('#mock' + ind),
                model: mockValues[ind]
            });
            setInterval(function (model) {
                model.fetch();
            }, 10000, mockValues[ind]);
        }, Math.random() * 10000, i);

    }

</script>
</body>
</html>
